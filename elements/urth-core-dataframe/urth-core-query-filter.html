!--
# Copyright (c) Jupyter Development Team.
# Distributed under the terms of the Modified BSD License.
-->
<link rel="import" href="../polymer/polymer.html">

<!--
Example:


@group Urth Core
@element urth-core-query-filter
-->
<dom-module id="urth-core-query-filter">
    <style>
        :host {
            display: none;
        }
    </style>
    <template><content id="expressions"></content></template>
</dom-module>
<script>

    (function() {
        'use strict';

        window.Urth = window.Urth || {};

        window.Urth['urth-core-query-filter'] = Polymer({
            is: 'urth-core-query-filter',

            properties: {
                disabled: {
                    type: Boolean,
                    value: false
                },

                expression: {
                    type: String,
                    notify: true
                },

                query: {
                    type: Object,
                    computed: '_buildQuery(expression, disabled)',
                    notify: true
                }
            },

            attached: function(){
                this._contentObserver = new MutationObserver( this._contentChanged.bind(this));
                this._contentObserver.observe( this, {
                    childList: true,
                    characterData: true,
                    subtree: true
                });

                this._contentChanged();
            },

            detached: function(){
                this._contentObserver.disconnect();
            },

            _buildQuery: function(){
                if( this.disabled ){
                    return undefined;
                }
                return {
                    type: "filter",
                    expr: this.expression
                }
            },

            _contentChanged: function(){
                //set the expression
                this.expression = this.textContent
                    .split('\n')
                    .map(function(line){return line.trim()})
                    .join(' ')
                    .trim();
            }
        });
    })();
</script>